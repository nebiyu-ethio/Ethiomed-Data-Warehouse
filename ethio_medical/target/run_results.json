{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.0b2", "generated_at": "2024-10-16T12:29:47.482359Z", "invocation_id": "bf7eadaf-5e38-40c9-955d-15152ceb19bc", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.246539Z", "completed_at": "2024-10-16T12:29:47.258478Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.259158Z", "completed_at": "2024-10-16T12:29:47.259178Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.01436758041381836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical.ethio_medical", "compiled": true, "compiled_code": "-- models/ethio_medical.sql\n  -- Correcting the materialization syntax\n\nWITH source_data AS (\n    SELECT * \n    FROM \"telegram\".\"public\".\"ethio_medical\"  -- Use DBT's source function\n)\n\nSELECT\n    channel_title,\n    lower(channel_username) AS channel_username,\n    message_id,\n    \"Message\",\n    date,\n    media_path\nFROM source_data\nWHERE \"Message\" IS NOT NULL", "relation_name": "\"telegram\".\"public\".\"ethio_medical\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.262480Z", "completed_at": "2024-10-16T12:29:47.267047Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.267756Z", "completed_at": "2024-10-16T12:29:47.267771Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006819725036621094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical.transformed_channel", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT\n        channel_username,\n        channel_title\n    FROM \"telegram\".\"public\".\"transformed_medical_product\"\n    WHERE contact_phone_numbers IS NOT NULL AND contact_phone_numbers != ''  -- Filter out any null or empty paths\n)\n\nSELECT DISTINCT ON (channel_username)  -- Ensure unique channel usernames\n    channel_username,\n    channel_title  -- Rename the column to be clearer\nFROM source_data", "relation_name": "\"telegram\".\"public\".\"transformed_channel\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.271915Z", "completed_at": "2024-10-16T12:29:47.276252Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.276984Z", "completed_at": "2024-10-16T12:29:47.276997Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0069675445556640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical.transformed_contact_number", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT\n        channel_username,\n        contact_phone_numbers\n    FROM \"telegram\".\"public\".\"transformed_medical_product\"\n    WHERE contact_phone_numbers IS NOT NULL AND contact_phone_numbers != ''  -- Filter out any null or empty paths\n)\n\nSELECT DISTINCT ON (channel_username)  -- Ensure unique channel usernames\n    channel_username,\n    contact_phone_numbers  -- Rename the column to be clearer\nFROM source_data", "relation_name": "\"telegram\".\"public\".\"transformed_contact_number\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.283783Z", "completed_at": "2024-10-16T12:29:47.289905Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.291297Z", "completed_at": "2024-10-16T12:29:47.291317Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012694120407104492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical.transformed_medical_product", "compiled": true, "compiled_code": "\n\nWITH source_data AS (\n    SELECT * \n    FROM \"telegram\".\"public\".\"ethio_medical\"\n),\nphone_extracted AS (\n    SELECT\n        message_id,\n        channel_title,\n        lower(channel_username) AS channel_username,\n        \"Message\",\n        date,\n        media_path,  -- Ensure this is being selected\n        -- Extract phone numbers with optional spaces\n        array_to_string(ARRAY(\n            SELECT regexp_replace(unnest(regexp_matches(\"Message\", '09\\s*[0-9]{8}', 'g')), '\\s+', '', 'g')\n        ), ', ') AS phone_numbers,\n        -- Clean the message of phone numbers\n        regexp_replace(\n            \"Message\", \n            '09\\s*[0-9]{8}', \n            '', \n            'g'\n        ) AS cleaned_message\n    FROM source_data\n),\nproduct_price_extracted AS (\n    SELECT\n        message_id,\n        channel_title,\n        channel_username,\n        date,\n        TRIM(cleaned_message) AS cleaned_message,\n        phone_numbers,\n        -- Adjusted regex to capture product names and prices\n        regexp_matches(cleaned_message, '^(.*?)\\s*(?:price|Price|PRICE)\\s*(\\d+)\\s*(birr|ETB)', 'g') AS matches,\n        media_path,  -- Include media_path here\n        ROW_NUMBER() OVER (PARTITION BY message_id ORDER BY date DESC) AS rn  -- Add row number to filter\n    FROM phone_extracted\n)\n\nSELECT\n    message_id,\n    channel_title,\n    channel_username,\n    date,\n    TRIM(matches[1]) AS product_name,  -- Extract product name\n    CAST(TRIM(matches[2]) AS INTEGER) AS price_in_birr,  -- Extract price as an integer\n    media_path,  -- Include media_path in the final selection\n    CASE\n        WHEN phone_numbers IS NOT NULL AND phone_numbers != '' THEN phone_numbers\n        ELSE NULL\n    END AS contact_phone_numbers  -- Renamed for clarity\nFROM product_price_extracted\nWHERE matches IS NOT NULL  -- Filter out any rows where matches are not found\nAND rn = 1  -- Select only the first occurrence of each message_id\nAND TRIM(matches[1]) <> ''  -- Drop empty product names\nAND TRIM(matches[1]) <> TRIM(matches[2])  -- Drop rows where product name and price are the same\nORDER BY message_id  -- Optional: order by message_id", "relation_name": "\"telegram\".\"public\".\"transformed_medical_product\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.297069Z", "completed_at": "2024-10-16T12:29:47.304048Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.304861Z", "completed_at": "2024-10-16T12:29:47.304876Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010368824005126953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical.transformed_product", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT\n        message_id as product_id,\n        product_name,\n        date,\n        price_in_birr  -- Rename the column to be clearer\n    FROM \"telegram\".\"public\".\"transformed_medical_product\"\n)\n\nSELECT   -- Ensure unique channel usernames\n    product_id,\n    product_name,\n    date,\n    price_in_birr  -- Rename the column to be clearer\nFROM source_data", "relation_name": "\"telegram\".\"public\".\"transformed_product\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.308755Z", "completed_at": "2024-10-16T12:29:47.313602Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.314453Z", "completed_at": "2024-10-16T12:29:47.314468Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007641792297363281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical.transformed_product_images", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT \n        message_id,\n        media_path  -- Assuming this column contains the image paths\n    FROM \"telegram\".\"public\".\"transformed_medical_product\"\n    WHERE media_path IS NOT NULL AND media_path != ''  -- Filter out any null or empty paths\n)\n\nSELECT\n    message_id,\n    media_path AS image_path  -- Rename the column to be clearer\nFROM source_data", "relation_name": "\"telegram\".\"public\".\"transformed_product_images\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.319074Z", "completed_at": "2024-10-16T12:29:47.339506Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.340645Z", "completed_at": "2024-10-16T12:29:47.340677Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.023702144622802734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_channel_channel_title.125e643652", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect channel_title\nfrom \"telegram\".\"public\".\"transformed_channel\"\nwhere channel_title is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.344872Z", "completed_at": "2024-10-16T12:29:47.352259Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.352952Z", "completed_at": "2024-10-16T12:29:47.352964Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009808540344238281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_channel_channel_username.da1cdd12f9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect channel_username\nfrom \"telegram\".\"public\".\"transformed_channel\"\nwhere channel_username is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.355993Z", "completed_at": "2024-10-16T12:29:47.365678Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.366324Z", "completed_at": "2024-10-16T12:29:47.366335Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.01173090934753418, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.unique_transformed_channel_channel_username.473920f54c", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    channel_username as unique_field,\n    count(*) as n_records\n\nfrom \"telegram\".\"public\".\"transformed_channel\"\nwhere channel_username is not null\ngroup by channel_username\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.369458Z", "completed_at": "2024-10-16T12:29:47.375518Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.376203Z", "completed_at": "2024-10-16T12:29:47.376215Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008231163024902344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_contact_number_channel_username.f35926ba31", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect channel_username\nfrom \"telegram\".\"public\".\"transformed_contact_number\"\nwhere channel_username is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.379248Z", "completed_at": "2024-10-16T12:29:47.385425Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.386083Z", "completed_at": "2024-10-16T12:29:47.386095Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008252620697021484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_contact_number_contact_phone_numbers.fb535ed729", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect contact_phone_numbers\nfrom \"telegram\".\"public\".\"transformed_contact_number\"\nwhere contact_phone_numbers is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.389562Z", "completed_at": "2024-10-16T12:29:47.395918Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.396590Z", "completed_at": "2024-10-16T12:29:47.396608Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008903980255126953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.unique_transformed_contact_number_channel_username.1571b803bc", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    channel_username as unique_field,\n    count(*) as n_records\n\nfrom \"telegram\".\"public\".\"transformed_contact_number\"\nwhere channel_username is not null\ngroup by channel_username\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.399945Z", "completed_at": "2024-10-16T12:29:47.405966Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.406616Z", "completed_at": "2024-10-16T12:29:47.406628Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008255958557128906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_product_date.55278c8234", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect date\nfrom \"telegram\".\"public\".\"transformed_product\"\nwhere date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.409776Z", "completed_at": "2024-10-16T12:29:47.415996Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.416652Z", "completed_at": "2024-10-16T12:29:47.416675Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008385419845581055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_product_price_in_birr.a6ae8fceb1", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect price_in_birr\nfrom \"telegram\".\"public\".\"transformed_product\"\nwhere price_in_birr is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.419800Z", "completed_at": "2024-10-16T12:29:47.428410Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.429129Z", "completed_at": "2024-10-16T12:29:47.429143Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010859489440917969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_product_product_id.151bf2ff49", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect product_id\nfrom \"telegram\".\"public\".\"transformed_product\"\nwhere product_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.432922Z", "completed_at": "2024-10-16T12:29:47.439409Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.440087Z", "completed_at": "2024-10-16T12:29:47.440175Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008955240249633789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_product_images_image_path.63ab13f217", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect image_path\nfrom \"telegram\".\"public\".\"transformed_product_images\"\nwhere image_path is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.443317Z", "completed_at": "2024-10-16T12:29:47.450403Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.451108Z", "completed_at": "2024-10-16T12:29:47.451121Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009384393692016602, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.not_null_transformed_product_images_message_id.d0b65198ff", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect message_id\nfrom \"telegram\".\"public\".\"transformed_product_images\"\nwhere message_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.454635Z", "completed_at": "2024-10-16T12:29:47.467500Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.468338Z", "completed_at": "2024-10-16T12:29:47.468351Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.015275955200195312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.relationships_transformed_product_images_message_id__product_id__ref_transformed_product_.06fb18072b", "compiled": true, "compiled_code": "\n    \n    \n\nwith child as (\n    select message_id as from_field\n    from \"telegram\".\"public\".\"transformed_product_images\"\n    where message_id is not null\n),\n\nparent as (\n    select product_id as to_field\n    from \"telegram\".\"public\".\"transformed_product\"\n)\n\nselect\n    from_field\n\nfrom child\nleft join parent\n    on child.from_field = parent.to_field\n\nwhere parent.to_field is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-16T12:29:47.471755Z", "completed_at": "2024-10-16T12:29:47.477950Z"}, {"name": "execute", "started_at": "2024-10-16T12:29:47.478612Z", "completed_at": "2024-10-16T12:29:47.478625Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008411645889282227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical.unique_transformed_product_images_message_id.ac309998fa", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    message_id as unique_field,\n    count(*) as n_records\n\nfrom \"telegram\".\"public\".\"transformed_product_images\"\nwhere message_id is not null\ngroup by message_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 0.38205671310424805, "args": {"log_format_file": "debug", "populate_cache": true, "which": "generate", "favor_state": false, "show_resource_report": false, "invocation_command": "dbt docs generate", "source_freshness_run_project_hooks": false, "static_parser": true, "exclude": [], "cache_selected_only": false, "quiet": false, "version_check": true, "require_resource_names_without_spaces": false, "use_colors_file": true, "print": true, "select": [], "log_level": "info", "partial_parse_file_diff": true, "empty_catalog": false, "state_modified_compare_more_unrendered_values": false, "indirect_selection": "eager", "log_format": "default", "compile": true, "introspect": true, "defer": false, "warn_error_options": {"include": [], "exclude": []}, "project_dir": "/home/neba/Desktop/Data_Engineering/KAMI/Week-7/Ethiomed-Data-Warehouse/ethio_medical", "macro_debugging": false, "strict_mode": false, "send_anonymous_usage_stats": true, "use_colors": true, "vars": {}, "log_file_max_bytes": 10485760, "log_level_file": "debug", "profiles_dir": "/home/neba/.dbt", "write_json": true, "partial_parse": true, "log_path": "/home/neba/Desktop/Data_Engineering/KAMI/Week-7/Ethiomed-Data-Warehouse/ethio_medical/logs", "static": false, "require_explicit_package_overrides_for_builtin_materializations": true, "state_modified_compare_vars": false, "printer_width": 80, "skip_nodes_if_on_run_start_fails": false}}